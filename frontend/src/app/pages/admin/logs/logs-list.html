<app-admin-layout>
  <div class="logs-page">
    <header class="page-header">
      <div class="header-title">
        <h1>Journalisation</h1>
        <p>{{ stats?.total || 0 }} actions enregistrÃ©es</p>
      </div>
    </header>

    <!-- Stats -->
    <section class="stats-section" *ngIf="stats">
      <div class="stat-card">
        <span class="stat-icon">â•</span>
        <div class="stat-info">
          <span class="stat-value">{{ stats.by_action['create'] || 0 }}</span>
          <span class="stat-label">CrÃ©ations</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">âœï¸</span>
        <div class="stat-info">
          <span class="stat-value">{{ stats.by_action['update'] || 0 }}</span>
          <span class="stat-label">Modifications</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ—‘ï¸</span>
        <div class="stat-info">
          <span class="stat-value">{{ stats.by_action['delete'] || 0 }}</span>
          <span class="stat-label">Suppressions</span>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ”‘</span>
        <div class="stat-info">
          <span class="stat-value">{{ stats.by_action['login'] || 0 }}</span>
          <span class="stat-label">Connexions</span>
        </div>
      </div>
    </section>

    <!-- Filtres -->
    <section class="filters-section">
      <div class="filters-row">
        <div class="filter-group">
          <label>Action</label>
          <select [(ngModel)]="filterAction" (change)="onFilterChange()">
            <option value="">Toutes</option>
            <option value="create">CrÃ©ation</option>
            <option value="update">Modification</option>
            <option value="delete">Suppression</option>
            <option value="login">Connexion</option>
            <option value="logout">DÃ©connexion</option>
          </select>
        </div>

        <div class="filter-group">
          <label>EntitÃ©</label>
          <select [(ngModel)]="filterEntity" (change)="onFilterChange()">
            <option value="">Toutes</option>
            <option value="user">Utilisateur</option>
            <option value="client">Client</option>
            <option value="event">Ã‰vÃ©nement</option>
            <option value="quote">Devis</option>
            <option value="prospect">Prospect</option>
            <option value="review">Avis</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Date dÃ©but</label>
          <input type="date" [(ngModel)]="filterDateFrom" (change)="onFilterChange()">
        </div>

        <div class="filter-group">
          <label>Date fin</label>
          <input type="date" [(ngModel)]="filterDateTo" (change)="onFilterChange()">
        </div>

        <button class="btn-reset" (click)="resetFilters()">ğŸ”„ RÃ©initialiser</button>
      </div>
    </section>

    <!-- Liste des logs -->
    <section class="logs-list">
      <div *ngIf="loading" class="loading">Chargement...</div>
      <div *ngIf="error" class="error">{{ error }}</div>
      <div *ngIf="!loading && logs.length === 0" class="empty">Aucun log trouvÃ©</div>

      <div class="logs-timeline" *ngIf="!loading && logs.length > 0">
        <div class="log-item" *ngFor="let log of logs" [class]="getActionClass(log.action)">
          <div class="log-icon">{{ getActionIcon(log.action) }}</div>
          <div class="log-content">
            <div class="log-header">
              <span class="action-badge" [class]="getActionClass(log.action)">
                {{ actionLabels[log.action] || log.action }}
              </span>
              <span class="entity-badge">
                {{ entityLabels[log.entity] || log.entity }}
                <span *ngIf="log.entity_id">#{{ log.entity_id }}</span>
              </span>
            </div>
            <div class="log-details" *ngIf="log.details">
              <span *ngFor="let key of getDetailsKeys(log.details)" class="detail-item">
                {{ key }}: {{ log.details[key] }}
              </span>
            </div>
            <div class="log-meta">
              <span class="user" *ngIf="log.user_id">ğŸ‘¤ {{ getUserName(log.user_id) }}</span>
              <span class="ip" *ngIf="log.ip_address">ğŸŒ {{ log.ip_address }}</span>
              <span class="date">ğŸ• {{ formatDate(log.created_at) }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</app-admin-layout>