<app-admin-layout>
  <div class="event-edit-page">
    <a routerLink="/admin/events" class="btn-back">‚Üê Retour √† la liste</a>

    <div *ngIf="loading" class="loading">Chargement...</div>
    <div *ngIf="error && !event.id" class="error">{{ error }}</div>

    <div *ngIf="!loading && event.id" class="edit-form">
      <header class="page-header">
        <h1>Modifier l'√©v√©nement</h1>
        <p>{{ event.name }}</p>
      </header>

      <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
      <div *ngIf="success" class="alert alert-success">{{ success }}</div>

      <form (ngSubmit)="saveEvent()">
        <section class="form-section">
          <h3>Informations g√©n√©rales</h3>
          
          <div class="form-group">
            <label>Nom de l'√©v√©nement *</label>
            <input type="text" [(ngModel)]="event.name" name="name" required>
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea [(ngModel)]="event.description" name="description" rows="4"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Type d'√©v√©nement</label>
              <select [(ngModel)]="event.event_type" name="event_type" required>
                <option value="">-- S√©lectionner --</option>
                <option *ngFor="let type of eventTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Th√®me</label>
              <select [(ngModel)]="event.theme" name="theme" required>
                <option value="">-- S√©lectionner --</option>
                <option *ngFor="let theme of themes" [value]="theme">{{ theme }}</option>
              </select>
            </div>
          </div>
        </section>

        <section class="form-section">
          <h3>Image de l'√©v√©nement</h3>
          
          <div class="form-group">
            <div class="image-upload">
              <div class="current-image" *ngIf="event.image_path && !imagePreview">
                <img [src]="getImageUrl(event.image_path)" alt="Image actuelle">
                <button type="button" class="btn-remove-image" (click)="removeCurrentImage()">‚úï Supprimer</button>
              </div>
              <input type="file" id="eventImageEdit" (change)="onImageSelected($event)" accept="image/*" #fileInput>
              <label for="eventImageEdit" class="upload-label">
                <span *ngIf="!imagePreview && !event.image_path">üì∑ Choisir une image</span>
                <span *ngIf="!imagePreview && event.image_path">üì∑ Changer l'image</span>
                <img *ngIf="imagePreview" [src]="imagePreview" alt="Aper√ßu" class="image-preview">
              </label>
              <button *ngIf="imagePreview" type="button" class="btn-remove-image" (click)="removeImage(fileInput)">‚úï Annuler</button>
            </div>
            <small class="hint">JPG, PNG, WebP ou GIF. Max 5 Mo.</small>
          </div>
        </section>

        <section class="form-section">
          <h3>D√©tails</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Date de d√©but</label>
              <input type="datetime-local" [(ngModel)]="event.start_date" name="start_date">
            </div>
            <div class="form-group">
              <label>Date de fin</label>
              <input type="datetime-local" [(ngModel)]="event.end_date" name="end_date">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Lieu</label>
              <input type="text" [(ngModel)]="event.location" name="location">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Nombre de participants</label>
              <input type="number" [(ngModel)]="event.attendees_count" name="attendees_count" min="0">
            </div>
            <div class="form-group">
              <label>Budget (‚Ç¨)</label>
              <input type="number" [(ngModel)]="event.budget" name="budget" min="0" step="0.01">
            </div>
          </div>
        </section>

        <section class="form-section">
          <h3>Visibilit√©</h3>
          
          <div class="visibility-toggle">
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="event.is_visible" name="is_visible">
              <span class="slider"></span>
            </label>
            <div class="toggle-label">
              <div class="toggle-title">{{ event.is_visible ? 'Visible sur le site public' : 'Masqu√© du site public' }}</div>
              <div class="toggle-desc">Les √©v√©nements visibles apparaissent sur la page publique des √©v√©nements</div>
            </div>
          </div>
        </section>

        <div class="form-actions">
          <a routerLink="/admin/events/{{ eventId }}" class="btn btn-secondary">Annuler</a>
          <button type="submit" class="btn btn-primary" [disabled]="saving">
            {{ saving ? 'Enregistrement...' : 'Enregistrer les modifications' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</app-admin-layout>
