<app-admin-layout>
  <div class="prospect-detail-page">
    <a routerLink="/admin/prospects" class="btn-back">‚Üê Retour √† la liste</a>

    <div *ngIf="loading" class="loading">
      <p>Chargement...</p>
    </div>

    <div *ngIf="error" class="error">
      <p>{{ error }}</p>
    </div>

    <div *ngIf="prospect && !loading" class="prospect-content">
      <header class="prospect-header">
        <div class="header-info">
          <h1>{{ prospect.company_name || 'Sans entreprise' }}</h1>
          <p class="contact-name">{{ prospect.first_name }} {{ prospect.last_name }}</p>
          <span class="status-badge" [class]="getStatusClass(prospect.status)">
            {{ statusLabels[prospect.status] }}
          </span>
        </div>

        <div class="header-actions" *ngIf="prospect.status !== 'converted'">
          <button *ngIf="prospect.status === 'to_contact'" 
                  (click)="updateStatus('qualification')" 
                  class="btn btn-primary">
            Passer en qualification
          </button>
          <button *ngIf="prospect.status === 'qualification'" 
                  (click)="convertToClient()" 
                  class="btn btn-success">
            ‚úÖ Convertir en client
          </button>
          <button *ngIf="prospect.status !== 'failed'" 
                  (click)="updateStatus('failed')" 
                  class="btn btn-danger">
            Marquer comme √©chou√©
          </button>
        </div>

        <div class="header-actions" *ngIf="prospect.status === 'converted'">
          <button (click)="createPrefilledEvent()" class="btn btn-primary">
            ‚ûï Cr√©er un √©v√©nement pr√©rempli
          </button>
        </div>
      </header>

      <!-- Image d'inspiration -->
      <section class="inspiration-image-section" *ngIf="prospect.image_path">
        <h3>üì∑ Image d'inspiration</h3>
        <img [src]="getImageUrl(prospect.image_path)" [alt]="'Image de ' + prospect.company_name" class="inspiration-image" (error)="onImageError($event)">
      </section>

      <div class="details-grid">
        <section class="detail-card">
          <h3>üìã Informations g√©n√©rales</h3>
          <div class="detail-row">
            <span class="label">Entreprise</span>
            <span class="value">{{ prospect.company_name || '-' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Nom</span>
            <span class="value">{{ prospect.last_name }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Pr√©nom</span>
            <span class="value">{{ prospect.first_name }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Date de cr√©ation</span>
            <span class="value">{{ formatDate(prospect.created_at) }}</span>
          </div>
        </section>

        <section class="detail-card">
          <h3>üìû Contact</h3>
          <div class="detail-row">
            <span class="label">Email</span>
            <span class="value">
              <a href="mailto:{{ prospect.email }}">{{ prospect.email }}</a>
            </span>
          </div>
          <div class="detail-row">
            <span class="label">T√©l√©phone</span>
            <span class="value">
              <a href="tel:{{ prospect.phone }}">{{ prospect.phone || '-' }}</a>
            </span>
          </div>
          <div class="detail-row">
            <span class="label">Lieu</span>
            <span class="value">{{ prospect.location || '-' }}</span>
          </div>
        </section>

        <section class="detail-card">
          <h3>üéâ Projet √©v√©nement</h3>
          <div class="detail-row">
            <span class="label">Type d'√©v√©nement</span>
            <span class="value">{{ prospect.event_type || '-' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Date souhait√©e</span>
            <span class="value">{{ formatDate(prospect.planned_date) }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Participants estim√©s</span>
            <span class="value">{{ prospect.estimated_participants || '-' }}</span>
          </div>
        </section>

        <section class="detail-card full-width">
          <h3>üìù Description du besoin</h3>
          <p class="needs-description">{{ prospect.needs_description || 'Aucune description fournie.' }}</p>
        </section>
      </div>
    </div>
  </div>
</app-admin-layout>
