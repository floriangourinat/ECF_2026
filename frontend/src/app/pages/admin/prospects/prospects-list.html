<app-admin-layout>
  <div class="prospects-page">
    <header class="page-header">
      <div class="header-title">
        <h1>Gestion des Prospects</h1>
        <p>{{ prospects.length }} prospect(s) au total</p>
      </div>
    </header>

    <!-- Filtres -->
    <section class="filters-section">
      <div class="search-box">
        <label class="sr-only" for="prospects-search-input">Recherche</label>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (keyup.enter)="onSearch()"
          placeholder="Rechercher par nom, entreprise, email..."
          id="prospects-search-input"
        >
        <button type="button" (click)="onSearch()" aria-label="Lancer la recherche"><span aria-hidden="true">üîç</span></button>
      </div>

      <div class="filter-box">
        <label class="sr-only" for="prospects-status-filter">Filtre</label>
        <select id="prospects-status-filter" [(ngModel)]="filterStatus" (change)="onFilterChange()">
          <option value="">Tous les statuts</option>
          <option value="to_contact">√Ä contacter</option>
          <option value="qualification">Qualification</option>
          <option value="failed">√âchou√©</option>
          <option value="converted">Converti</option>
        </select>
      </div>
    </section>

    <!-- Liste -->
    <section class="prospects-list">
      <div *ngIf="loading" class="loading">
        <p>Chargement...</p>
      </div>

      <div *ngIf="error" class="error">
        <p>{{ error }}</p>
      </div>

      <div *ngIf="!loading && prospects.length === 0" class="empty">
        <p>Aucun prospect trouv√©</p>
      </div>

      <table *ngIf="!loading && prospects.length > 0" class="prospects-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Entreprise</th>
            <th>Contact</th>
            <th>Email</th>
            <th>Type √©v√©nement</th>
            <th>Date souhait√©e</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let prospect of prospects">
            <td class="image-cell">
              <img *ngIf="prospect.image_path" 
                   [src]="getImageUrl(prospect.image_path)" 
                   [alt]="prospect.company_name"
                   class="prospect-thumbnail"
                   (error)="onImageError($event)">
              <span *ngIf="!prospect.image_path" class="no-image">üì∑</span>
            </td>
            <td class="company">
              <strong>{{ prospect.company_name || '-' }}</strong>
            </td>
            <td>{{ prospect.first_name }} {{ prospect.last_name }}</td>
            <td>{{ prospect.email }}</td>
            <td>{{ prospect.event_type || '-' }}</td>
            <td>{{ formatDate(prospect.planned_date) }}</td>
            <td>
              <span class="status-badge" [class]="getStatusClass(prospect.status)">
                {{ statusLabels[prospect.status] }}
              </span>
            </td>
            <td class="actions">
              <a [routerLink]="['/admin/prospects', prospect.id]" class="btn-view" title="Voir d√©tails" aria-label="Voir les d√©tails"><span aria-hidden="true">üëÅÔ∏è</span></a>
              
              <div class="dropdown" *ngIf="prospect.status !== 'converted'">
                <button type="button" class="btn-action" aria-label="Actions du prospect"><span aria-hidden="true">‚öôÔ∏è</span></button>
                <div class="dropdown-content">
                  <button *ngIf="prospect.status === 'to_contact'" (click)="updateStatus(prospect, 'qualification')">
                    Passer en qualification
                  </button>
                  <button *ngIf="prospect.status !== 'converted' && prospect.status !== 'failed'" (click)="updateStatus(prospect, 'failed')">
                    Marquer comme √©chou√©
                  </button>
                  <button *ngIf="prospect.status === 'qualification'" (click)="convertToClient(prospect)" class="btn-convert">
                    ‚úÖ Convertir en client
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
  </div>
</app-admin-layout>
