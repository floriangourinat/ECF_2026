<app-employee-layout>
  <div class="page">
    <a routerLink="/employee/events" class="btn-back">â† Retour aux Ã©vÃ©nements</a>
    <div *ngIf="loading" class="loading">Chargement...</div>

    <div *ngIf="!loading && event" class="event-detail">
      <!-- Header -->
      <header class="detail-header">
        <div>
          <h1>{{ event.name }}</h1>
          <p class="meta">{{ event.client_company || '-' }} Â· {{ formatDate(event.start_date) }} Â· {{ event.location || '-' }}</p>
        </div>
        <span class="status-badge status-{{ event.status }}">{{ statusLabels[event.status] }}</span>
      </header>

      <!-- Infos -->
      <section class="info-section" *ngIf="event.description">
        <h3>ğŸ“ Description</h3>
        <p>{{ event.description }}</p>
      </section>

      <!-- TÃ¢ches -->
      <section class="section">
        <h3>âœ… TÃ¢ches ({{ tasks.length }})</h3>
        <div *ngIf="tasks.length === 0" class="empty">Aucune tÃ¢che pour cet Ã©vÃ©nement</div>
        <div class="tasks-list" *ngIf="tasks.length > 0">
          <div *ngFor="let task of tasks" class="task-card" [class.my-task]="isMyTask(task)">
            <div class="task-info">
              <strong>{{ task.title }}</strong>
              <small *ngIf="task.description">{{ task.description }}</small>
              <small class="meta">
                AssignÃ©e Ã  : {{ task.assigned_first_name }} {{ task.assigned_last_name }}
                <span *ngIf="task.due_date"> Â· Ã‰chÃ©ance : {{ formatDate(task.due_date) }}</span>
              </small>
            </div>
            <div class="task-actions">
              <span class="status-badge status-{{ task.status }}">{{ taskStatusLabels[task.status] }}</span>
              <button *ngIf="isMyTask(task) && getNextStatus(task.status)" 
                      class="btn-advance" 
                      (click)="onAdvanceTask(task)">
                â†’ {{ taskStatusLabels[getNextStatus(task.status) || ''] }}
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Notes -->
      <section class="section">
        <h3>ğŸ’¬ Notes ({{ notes.length }})</h3>

        <!-- Ajouter une note -->
        <div class="add-note">
          <textarea [(ngModel)]="newNoteContent" placeholder="Ajouter une note collaborative..." rows="3"></textarea>
          <button (click)="addNote()" [disabled]="addingNote || !newNoteContent.trim()" class="btn-add">
            {{ addingNote ? 'Ajout...' : 'Ajouter' }}
          </button>
        </div>

        <div *ngIf="notes.length === 0" class="empty">Aucune note</div>
        <div class="notes-list">
          <div *ngFor="let note of notes" class="note-card">
            <div class="note-header">
              <strong>{{ note.first_name }} {{ note.last_name }}</strong>
              <span class="note-date">{{ formatDateTime(note.created_at) }}</span>
            </div>

            <!-- Mode lecture -->
            <p *ngIf="editingNoteId !== note.id" class="note-content">{{ note.content }}</p>

            <!-- Mode Ã©dition -->
            <div *ngIf="editingNoteId === note.id" class="note-edit">
              <textarea [(ngModel)]="editNoteContent" rows="3"></textarea>
              <div class="edit-actions">
                <button class="btn-save" (click)="saveEditNote(note)">Enregistrer</button>
                <button class="btn-cancel" (click)="cancelEditNote()">Annuler</button>
              </div>
            </div>

            <!-- Actions (seulement mes notes) -->
            <div *ngIf="isMyNote(note) && editingNoteId !== note.id" class="note-actions">
              <button (click)="startEditNote(note)" class="btn-edit" aria-label="Modifier la note">âœï¸</button>
              <button (click)="deleteNote(note)" class="btn-delete" aria-label="Supprimer la note">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</app-employee-layout>
